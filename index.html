<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <title>Document</title>
  </head>
  <body>
    <h2>ルーレット</h2>
    <h2 id="gift"></h2>
    <h2 id="val"></h2>
    <button id="start">スタート</button>
    <button id="finish">ストップ</button>
  </body>
  <script>

    let nameList = [];
    let gift = "";
    fetch(
      "https://docs.google.com/spreadsheets/d/1Z8sDgL_xPxY3t-8hC7KDcvmRnhrGpRay-OHKD8IIyBc/export?format=csv&gid=0"
    )
      .then((res) => res.text())
      .then((csvText) => {
        const parsedData = Papa.parse(csvText, { header: true });
        const dataArray = parsedData.data;

        // 例：name4列だけを取り出す
        nameList = dataArray.map((row) => row.name);
        console.log(nameList);
      })
      .catch((err) => console.error(err));
    
    fetch(
      "https://docs.google.com/spreadsheets/d/1Z8sDgL_xPxY3t-8hC7KDcvmRnhrGpRay-OHKD8IIyBc/export?format=csv&gid=0"
    )
    .then((response) => response.text())
    .then((csvText) => {
      const parsedData2 = Papa.parse(csvText, { header: true });
      const storeData = parsedData2.data;

      // A2セルの値（spot2列の1行目の値）を取得
      const gift  = storeData[0]?.gift || "不明";
      document.getElementById("gift").textContent = gift;
      
    });

    const start = document.getElementById("start");
    console.log(start);
    start.addEventListener("click", function () {
      const roulette = setInterval(function () {
        const val = Math.floor(Math.random() * nameList.length);
        const nameVal = nameList[val];
        console.log(nameVal);
        document.getElementById("val").textContent = nameVal;

        const finish = document.getElementById("finish");
        finish.addEventListener("click", function () {
          clearInterval(roulette);
        });
      }, 100);
    });
  </script>
</html>
